#!/bin/bash
# Pre-commit hook for Flutter/Dart projects
# Runs format and analyze on lib/ before allowing commit
#
# To install: cp scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit
# Or run: ./scripts/setup-hooks.sh

set -e

echo "ğŸ” Running pre-commit checks..."

# Format lib/ and test/
echo "ğŸ“ Formatting code..."
dart format --set-exit-if-changed lib/ test/
if [ $? -ne 0 ]; then
  echo "âŒ Formatting failed. Run 'dart format lib/ test/' to fix."
  exit 1
fi

# Analyze lib/ only (matches CI - test files have tolerated warnings)
echo "ğŸ”¬ Analyzing lib/..."
flutter analyze lib/ --no-fatal-infos
if [ $? -ne 0 ]; then
  echo "âŒ Analysis found errors. Fix them before committing."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
