#!/bin/bash
# Pre-commit hook for Flutter/Dart projects
# Install: cp scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

# Allow bypass for emergencies: SKIP_HOOKS=1 git commit -m "WIP"
if [ "$SKIP_HOOKS" = "1" ]; then
  echo "‚ö†Ô∏è  Skipping pre-commit hooks (SKIP_HOOKS=1)"
  exit 0
fi

echo "üîç Running pre-commit checks..."

# Get staged Dart files only
STAGED_DART=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.dart$' || true)

if [ -z "$STAGED_DART" ]; then
  echo "‚úÖ No Dart files staged, skipping checks"
  exit 0
fi

# Format only staged files
echo "üìù Checking format on staged files..."
echo "$STAGED_DART" | xargs dart format --set-exit-if-changed

# Analyze lib/ (full analysis - catches cross-file issues)
echo "üî¨ Analyzing lib/..."
flutter analyze lib/ --no-fatal-infos

echo "‚úÖ Pre-commit checks passed!"
